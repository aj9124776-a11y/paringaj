        // Cambiar contraseña - MEJORADO
        function changePassword() {
            const currentPassword = document.getElementById('current-password').value.trim();
            const newPassword = document.getElementById('new-password').value.trim();
            const confirmPassword = document.getElementById('confirm-password').value.trim();
            
            if (currentPassword !== currentUser.password) {
                showNotification('La contraseña actual es incorrecta', 'error');
                return;
            }
            
            if (newPassword.length < 6) {
                showNotification('La nueva contraseña debe tener al menos 6 caracteres', 'error');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showNotification('Las contraseñas nuevas no coinciden', 'error');
                return;
            }
            
            // Actualizar contraseña
            currentUser.password = newPassword;
            
            // Actualizar en el almacenamiento
            if (currentUser.role === 'admin') {
                const userIndex = users.findIndex(u => u.id === currentUser.id);
                if (userIndex !== -1) {
                    users[userIndex].password = newPassword;
                    saveToLocalStorage('parkingUsers', users);
                }
            } else {
                const clientIndex = clients.findIndex(c => {        // ==================== SISTEMA DE ALMACENAMIENTO PERSISTENTE ====================
        
        // Función para guardar datos en LocalStorage
        function saveToLocalStorage(key, data) {
            try {
                localStorage.setItem(key, JSON.stringify(data));
                return true;
            } catch (error) {
                console.error('Error guardando en localStorage:', error);
                showNotification('Error al guardar datos', 'error');
                return false;
            }
        }

        // Función para cargar datos desde LocalStorage
        function loadFromLocalStorage(key, defaultValue = []) {
            try {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : defaultValue;
            } catch (error) {
                console.error('Error cargando desde localStorage:', error);
                return defaultValue;
            }
        }

        // Función para inicializar datos por primera vez
        function initializeData() {
            // Verificar si ya existen datos en LocalStorage
            let existingUsers = loadFromLocalStorage('parkingUsers');
            let existingClients = loadFromLocalStorage('parkingClients');
            let existingSpaces = loadFromLocalStorage('parkingSpaces');
            let existingSales = loadFromLocalStorage('parkingSales');

            // Si no hay datos, inicializar con datos por defecto
            if (existingUsers.length === 0) {
                const defaultUsers = [
                    {
                        id: 1,
                        name: "Administrador Principal",
                        email: "admin@parkmaster.com",
                        password: "admin123",
                        role: "admin",
                        phone: "+1 234-567-8900",
                        address: "Av. Principal 123, Ciudad"
                    }
                ];
                saveToLocalStorage('parkingUsers', defaultUsers);
                existingUsers = defaultUsers;
            }

            if (existingSpaces.length === 0) {
                const defaultSpaces = [];
                
                // Generar 140 espacios (A-01 a A-50, B-01 a B-50, C-01 a C-40)
                for (let i = 1; i <= 50; i++) {
                    defaultSpaces.push({
                        id: `A-${i.toString().padStart(2, '0')}`,
                        status: "available",
                        type: "standard",
                        maintenance: false
                    });
                }
                
                for (let i = 1; i <= 50; i++) {
                    defaultSpaces.push({
                        id: `B-${i.toString().padStart(2, '0')}`,
                        status: "available",
                        type: "standard", 
                        maintenance: false
                    });
                }
                
                for (let i = 1; i <= 40; i++) {
                    defaultSpaces.push({
                        id: `C-${i.toString().padStart(2, '0')}`,
                        status: "available",
                        type: "premium",
                        maintenance: false
                    });
                }
                
                saveToLocalStorage('parkingSpaces', defaultSpaces);
                existingSpaces = defaultSpaces;
            }

            // Actualizar estados de suscripciones
            if (existingClients.length > 0) {
                let updated = false;
                existingClients.forEach(client => {
                    const newStatus = calculateSubscriptionStatus(client.subscription.endDate);
                    if (client.subscription.status !== newStatus) {
                        client.subscription.status = newStatus;
                        updated = true;
                    }
                });
                if (updated) {
                    saveToLocalStorage('parkingClients', existingClients);
                }
            }

            // Retornar datos actualizados
            return {
                users: existingUsers,
                clients: existingClients,
                spaces: existingSpaces,
                sales: existingSales
            };
        }