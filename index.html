<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ParkMaster - Gestión de Estacionamiento</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2ecc71;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --dark-color: #2c3e50;
            --light-color: #ecf0f1;
            --admin-color: #9b59b6;
            --client-color: #1abc9c;
            --accounting-color: #16a085;
            --info-color: #2980b9;
            --sales-color: #e67e22;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* Header y Navegación */
        header {
            background: linear-gradient(135deg, var(--dark-color) 0%, #34495e 100%);
            color: white;
            padding: 1rem 0;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo i {
            color: var(--primary-color);
        }
        
        .logo span {
            color: var(--primary-color);
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .user-role {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .user-role.admin {
            background-color: var(--admin-color);
        }
        
        .user-role.client {
            background-color: var(--client-color);
        }
        
        nav ul {
            display: flex;
            list-style: none;
        }
        
        nav ul li {
            margin-left: 20px;
        }
        
        nav ul li a {
            color: white;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 4px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
            white-space: nowrap;
        }
        
        nav ul li a:hover, nav ul li a.active {
            background-color: var(--primary-color);
            transform: translateY(-2px);
        }
        
        /* Login */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 80vh;
        }
        
        .login-form {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 400px;
            border-top: 5px solid var(--primary-color);
        }
        
        .login-form h2 {
            text-align: center;
            margin-bottom: 20px;
            color: var(--dark-color);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        /* Módulos */
        .module {
            display: none;
            background-color: white;
            border-radius: 12px;
            padding: 25px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .module.active {
            display: block;
        }
        
        h2 {
            color: var(--dark-color);
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--light-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        h3 {
            margin-top: 25px;
            margin-bottom: 15px;
            color: var(--dark-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        /* Tarjetas de Clientes/Espacios */
        .client-card, .space-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            border-left: 5px solid var(--primary-color);
            transition: all 0.3s;
        }
        
        .client-card:hover, .space-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .client-card.active {
            border-left-color: var(--secondary-color);
        }
        
        .client-card.expired {
            border-left-color: var(--danger-color);
        }
        
        .client-card.warning {
            border-left-color: var(--warning-color);
        }
        
        .space-card.available {
            border-left-color: var(--secondary-color);
        }
        
        .space-card.occupied {
            border-left-color: var(--primary-color);
        }
        
        .space-card.maintenance {
            border-left-color: var(--warning-color);
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .client-name, .space-name {
            font-weight: bold;
            font-size: 1.3rem;
        }
        
        .status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .status.active {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .status.expired {
            background-color: var(--danger-color);
            color: white;
        }
        
        .status.warning {
            background-color: var(--warning-color);
            color: white;
        }
        
        .status.available {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .status.occupied {
            background-color: var(--primary-color);
            color: white;
        }
        
        .status.maintenance {
            background-color: var(--warning-color);
            color: white;
        }
        
        .card-details {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .detail-item {
            margin-bottom: 8px;
        }
        
        .detail-label {
            font-weight: bold;
            color: #777;
            font-size: 0.9rem;
        }
        
        /* Botones y Acciones */
        .actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 10px 18px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }
        
        .btn-success {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }
        
        .btn-warning {
            background-color: var(--warning-color);
            color: white;
        }
        
        .btn-info {
            background-color: var(--info-color);
            color: white;
        }
        
        .btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        /* Formularios */
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--dark-color);
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 1rem;
            transition: border 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.1);
        }
        
        input:invalid, select:invalid {
            border-color: var(--danger-color);
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
        }
        
        small {
            display: block;
            margin-top: 5px;
            color: #666;
            font-size: 0.85rem;
        }
        
        /* Búsqueda */
        .search-bar {
            margin-bottom: 20px;
            position: relative;
        }
        
        .search-bar input {
            padding: 12px 45px 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            width: 100%;
        }
        
        .search-bar i {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #777;
        }
        
        /* Estadísticas */
        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            transition: all 0.3s;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .stat-value {
            font-size: 2.2rem;
            font-weight: bold;
            margin: 15px 0;
        }
        
        .stat-card.active {
            border-top: 4px solid var(--secondary-color);
        }
        
        .stat-card.expired {
            border-top: 4px solid var(--danger-color);
        }
        
        .stat-card.warning {
            border-top: 4px solid var(--warning-color);
        }
        
        .stat-card.total {
            border-top: 4px solid var(--primary-color);
        }
        
        .stat-card.income {
            border-top: 4px solid var(--accounting-color);
        }
        
        .stat-card.info {
            border-top: 4px solid var(--info-color);
        }
        
        .stat-card.sales {
            border-top: 4px solid var(--sales-color);
        }
        
        /* Grid de Espacios */
        .spaces-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .space-item {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .space-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .space-item.available {
            background-color: #e8f5e8;
            border: 2px solid var(--secondary-color);
        }
        
        .space-item.occupied {
            background-color: #e3f2fd;
            border: 2px solid var(--primary-color);
        }
        
        .space-item.maintenance {
            background-color: #fef9e7;
            border: 2px solid var(--warning-color);
        }
        
        .space-number {
            font-size: 1.6rem;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .space-info {
            font-size: 0.8rem;
            color: #666;
            margin-top: 5px;
        }
        
        .space-actions {
            margin-top: 10px;
            display: flex;
            gap: 5px;
            justify-content: center;
        }
        
        .space-actions .btn {
            padding: 5px 10px;
            font-size: 0.8rem;
        }
        
        /* Estados vacíos */
        .empty-state {
            text-align: center;
            padding: 50px;
            color: #666;
        }
        
        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            color: #ddd;
        }
        
        /* Tablas */
        .table-container {
            overflow-x: auto;
            margin-top: 20px;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            background: white;
        }
        
        th, td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        
        th {
            background-color: var(--light-color);
            font-weight: bold;
            color: var(--dark-color);
            position: sticky;
            top: 0;
        }
        
        tr:hover {
            background-color: #f9f9f9;
        }
        
        /* Filtros de contabilidad */
        .filters {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        }
        
        .filter-row {
            display: flex;
            gap: 15px;
            align-items: end;
            flex-wrap: wrap;
        }
        
        .filter-group {
            flex: 1;
            min-width: 200px;
        }
        
        /* Notificaciones */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 8px;
            color: white;
            font-weight: bold;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transform: translateX(120%);
            transition: transform 0.3s ease-in-out;
            max-width: 400px;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            background-color: var(--secondary-color);
        }
        
        .notification.error {
            background-color: var(--danger-color);
        }
        
        .notification.warning {
            background-color: var(--warning-color);
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 25px;
            color: #777;
            border-top: 1px solid #ddd;
            background: white;
            border-radius: 10px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.08);
        }
        
        /* Modales */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal-content {
            background-color: white;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .modal-small {
            max-width: 500px;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        
        .modal-title {
            font-size: 1.5rem;
            color: var(--dark-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #777;
            transition: color 0.3s;
        }
        
        .close-modal:hover {
            color: var(--danger-color);
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            nav ul {
                margin-top: 15px;
                justify-content: center;
                flex-wrap: wrap;
                gap: 10px;
            }
            
            nav ul li {
                margin: 0;
            }
            
            .card-details {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .actions {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .spaces-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            }
            
            .filter-row {
                flex-direction: column;
            }
            
            .filter-group {
                width: 100%;
            }
            
            .stats {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            .module {
                padding: 15px;
            }
            
            .stats {
                grid-template-columns: 1fr 1fr;
            }
            
            .spaces-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
            
            nav ul li a span {
                display: none;
            }
            
            nav ul li a {
                padding: 8px 12px;
            }
        }
    </style>
</head>
<body>
    <div id="notification" class="notification"></div>
    
    <div id="login-screen">
        <header>
            <div class="container">
                <div class="header-content">
                    <div class="logo">
                        <i class="fas fa-parking"></i>
                        Park<span>Master</span>
                    </div>
                </div>
            </div>
        </header>
        
        <div class="container">
            <div class="login-container">
                <div class="login-form">
                    <h2><i class="fas fa-parking"></i> Iniciar Sesión</h2>
                    <form id="login-form">
                        <div class="form-group">
                            <label for="login-email"><i class="fas fa-envelope"></i> Email</label>
                            <input type="email" id="login-email" required placeholder="tu@email.com">
                        </div>
                        <div class="form-group">
                            <label for="login-password"><i class="fas fa-lock"></i> Contraseña</label>
                            <input type="password" id="login-password" required placeholder="••••••••">
                        </div>
                        <div class="form-group">
                            <button type="submit" class="btn btn-primary" style="width: 100%;">
                                <i class="fas fa-sign-in-alt"></i> Ingresar
                            </button>
                        </div>

                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <div id="app" style="display: none;">
        <header>
            <div class="container">
                <div class="header-content">
                    <div class="logo">
                        <i class="fas fa-parking"></i>
                        Park<span>Master</span>
                    </div>
                    <nav>
                        <ul>
                            <li><a href="#" class="nav-link active" data-module="dashboard">
                                <i class="fas fa-tachometer-alt"></i> <span>Dashboard</span>
                            </a></li>
                            <li class="admin-only" style="display: none;">
                                <a href="#" class="nav-link" data-module="clients">
                                    <i class="fas fa-users"></i> <span>Clientes</span>
                                </a>
                            </li>
                            <li class="admin-only" style="display: none;">
                                <a href="#" class="nav-link" data-module="spaces">
                                    <i class="fas fa-car"></i> <span>Espacios</span>
                                </a>
                            </li>
                            <li class="admin-only" style="display: none;">
                                <a href="#" class="nav-link" data-module="sales">
                                    <i class="fas fa-cash-register"></i> <span>Ventas</span>
                                </a>
                            </li>
                            <li class="admin-only" style="display: none;">
                                <a href="#" class="nav-link" data-module="accounting">
                                    <i class="fas fa-chart-line"></i> <span>Contabilidad</span>
                                </a>
                            </li>
                            <li><a href="#" class="nav-link" data-module="profile">
                                <i class="fas fa-user"></i> <span>Mi Perfil</span>
                            </a></li>
                        </ul>
                    </nav>
                    <div class="user-info">
                        <span id="user-name">Usuario</span>
                        <span id="user-role" class="user-role">Rol</span>
                        <button id="logout-btn" class="btn btn-danger">
                            <i class="fas fa-sign-out-alt"></i> <span>Salir</span>
                        </button>
                    </div>
                </div>
            </div>
        </header>
        
        <div class="container">
            <div id="dashboard" class="module active">
                <h2><i class="fas fa-tachometer-alt"></i> Dashboard</h2>
                <div id="admin-dashboard" style="display: none;">
                    <div class="stats">
                        <div class="stat-card total">
                            <div class="stat-label">Total Clientes</div>
                            <div class="stat-value" id="total-clients">0</div>
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-card active">
                            <div class="stat-label">Suscripciones Activas</div>
                            <div class="stat-value" id="active-subscriptions">0</div>
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-card warning">
                            <div class="stat-label">Por Vencer (7 días)</div>
                            <div class="stat-value" id="warning-subscriptions">0</div>
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-card expired">
                            <div class="stat-label">Vencidas</div>
                            <div class="stat-value" id="expired-subscriptions">0</div>
                            <i class="fas fa-times-circle"></i>
                        </div>
                        <div class="stat-card income">
                            <div class="stat-label">Ingreso Mensual</div>
                            <div class="stat-value" id="monthly-income">$0</div>
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="stat-card sales">
                            <div class="stat-label">Ventas Hoy</div>
                            <div class="stat-value" id="today-sales">$0</div>
                            <i class="fas fa-cash-register"></i>
                        </div>
                    </div>
                    
                    <h3><i class="fas fa-users"></i> Clientes Recientes</h3>
                    <div class="search-bar">
                        <input type="text" id="search-dashboard" placeholder="Buscar cliente...">
                        <i class="fas fa-search"></i>
                    </div>
                    
                    <div id="clients-list-dashboard"></div>
                </div>
                
                <div id="client-dashboard" style="display: none;">
                    <div class="client-card active">
                        <div class="card-header">
                            <div class="client-name" id="client-dash-name">Nombre del Cliente</div>
                            <div class="status active" id="client-dash-status">Activa</div>
                        </div>
                        <div class="card-details">
                                <span class="detail-label">Próximo Vencimiento:</span>
                                <span id="client-dash-expiry">-</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Días Restantes:</span>
                                <span id="client-dash-days">-</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Monto Mensual:</span>
                                <span id="client-dash-amount">-</span>
                            </div>
                        </div>
                    </div>
                    
                    <h3 style="margin-top: 30px;"><i class="fas fa-history"></i> Historial de Pagos</h3>
                    <div id="payment-history"></div>
                </div>
            </div>
            
            <div id="clients" class="module">
                <h2><i class="fas fa-users"></i> Gestión de Clientes</h2>
                
                <div class="actions" style="margin-bottom: 20px;">
                    <button id="add-client-btn" class="btn btn-success">
                        <i class="fas fa-plus"></i> Agregar Cliente
                    </button>
                    <button id="export-clients-btn" class="btn btn-info">
                        <i class="fas fa-file-excel"></i> Exportar a Excel
                    </button>
                </div>
                
                <div class="search-bar">
                    <input type="text" id="search-clients" placeholder="Buscar por nombre, placa o email...">
                    <i class="fas fa-search"></i>
                </div>
                
                <div id="clients-list"></div>
            </div>
            
            <div id="spaces" class="module">
                <h2><i class="fas fa-car"></i> Gestión de Espacios</h2>
                
                <div class="stats">
                    <div class="stat-card total">
                        <div class="stat-label">Total Espacios</div>
                        <div class="stat-value" id="total-spaces">0</div>
                        <i class="fas fa-parking"></i>
                    </div>
                    <div class="stat-card active">
                        <div class="stat-label">Disponibles</div>
                        <div class="stat-value" id="available-spaces">0</div>
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-card occupied">
                        <div class="stat-label">Ocupados</div>
                        <div class="stat-value" id="occupied-spaces">0</div>
                        <i class="fas fa-car"></i>
                    </div>
                    <div class="stat-card warning">
                        <div class="stat-label">En Mantenimiento</div>
                        <div class="stat-value" id="maintenance-spaces">0</div>
                        <i class="fas fa-tools"></i>
                    </div>
                </div>
                
                <div class="actions" style="margin-bottom: 20px;">
                    <button id="add-space-btn" class="btn btn-success">
                        <i class="fas fa-plus"></i> Agregar Espacio
                    </button>
                </div>
                
                <h3><i class="fas fa-map"></i> Mapa de Espacios</h3>
                <div class="spaces-grid" id="spaces-grid"></div>
            </div>
            
            <div id="sales" class="module">
                <h2><i class="fas fa-cash-register"></i> Ventas Diarias</h2>
                
                <div class="stats">
                    <div class="stat-card sales">
                        <div class="stat-label">Ventas de Hoy</div>
                        <div class="stat-value" id="today-sales-amount">$0</div>
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <div class="stat-card income">
                        <div class="stat-label">Ventas del Mes</div>
                        <div class="stat-value" id="month-sales-amount">$0</div>
                        <i class="fas fa-chart-line"></i>
                    </div>
                    <div class="stat-card total">
                        <div class="stat-label">Total Ventas</div>
                        <div class="stat-value" id="total-sales-amount">$0</div>
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <div class="stat-card info">
                        <div class="stat-label">Promedio Diario</div>
                        <div class="stat-value" id="average-daily-sales">$0</div>
                        <i class="fas fa-chart-bar"></i>
                    </div>
                </div>
                
                <div class="actions" style="margin-bottom: 20px;">
                    <button id="add-sale-btn" class="btn btn-success">
                        <i class="fas fa-plus"></i> Registrar Venta
                    </button>
                    <button id="export-sales-btn" class="btn btn-info">
                        <i class="fas fa-file-excel"></i> Exportar a Excel
                    </button>
                </div>
                
                <h3><i class="fas fa-history"></i> Registro de Ventas</h3>
                <div class="table-container">
                    <table id="sales-table">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Concepto</th>
                                <th>Vehículo/Placa</th>
                                <th>Tipo</th>
                                <th>Monto</th>
                                <th>Método de Pago</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="sales-table-body"></tbody>
                    </table>
                </div>
            </div>
            
            <div id="accounting" class="module">
                <h2><i class="fas fa-chart-line"></i> Contabilidad</h2>
                
                <div class="stats">
                    <div class="stat-card income">
                        <div class="stat-label">Ingresos del Mes</div>
                        <div class="stat-value" id="current-month-income">$0</div>
                        <i class="fas fa-dollar-sign"></i>
                    </div>
                    <div class="stat-card total">
                        <div class="stat-label">Ingresos Totales</div>
                        <div class="stat-value" id="total-income">$0</div>
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <div class="stat-card active">
                        <div class="stat-label">Clientes Activos</div>
                        <div class="stat-value" id="accounting-active-clients">0</div>
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-card info">
                        <div class="stat-label">Espacios Ocupados</div>
                        <div class="stat-value" id="accounting-occupied-spaces">0</div>
                        <i class="fas fa-car"></i>
                    </div>
                </div>
                
                <div class="filters">
                    <div class="filter-row">
                        <div class="filter-group">
                            <label for="date-from">Desde</label>
                            <input type="date" id="date-from">
                        </div>
                        <div class="filter-group">
                            <label for="date-to">Hasta</label>
                            <input type="date" id="date-to">
                        </div>
                        <div class="filter-group">
                            <label for="income-type">Tipo de Ingreso</label>
                            <select id="income-type">
                                <option value="all">Todos</option>
                                <option value="subscription">Suscripciones</option>
                                <option value="daily">Ventas Diarias</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <button id="filter-income-btn" class="btn btn-primary">
                                <i class="fas fa-filter"></i> Filtrar
                            </button>
                        </div>
                    </div>
                </div>
                
                <h3><i class="fas fa-list"></i> Detalle de Ingresos</h3>
                <div class="table-container">
                    <table id="income-table">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Concepto</th>
                                <th>Cliente</th>
                                <th>Tipo</th>
                                <th>Monto</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody id="income-table-body"></tbody>
                    </table>
                </div>
            </div>
            
            <div id="profile" class="module">
                <h2><i class="fas fa-user"></i> Mi Perfil</h2>
                
                <form id="profile-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="profile-name"><i class="fas fa-user"></i> Nombre Completo</label>
                            <input type="text" id="profile-name" required placeholder="Tu nombre completo">
                        </div>
                        <div class="form-group">
                            <label for="profile-email"><i class="fas fa-envelope"></i> Email</label>
                            <input type="email" id="profile-email" required placeholder="tu@email.com">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="profile-phone"><i class="fas fa-phone"></i> Teléfono</label>
                            <input type="tel" id="profile-phone" placeholder="+1234567890">
                        </div>
                        <div class="form-group">
                            <label for="profile-address"><i class="fas fa-home"></i> Dirección</label>
                            <input type="text" id="profile-address" placeholder="Tu dirección">
                        </div>
                    </div>
                    
                    <h3 style="margin-top: 30px;"><i class="fas fa-lock"></i> Cambiar Contraseña</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="current-password">Contraseña Actual</label>
                            <input type="password" id="current-password" placeholder="••••••••">
                        </div>
                        <div class="form-group">
                            <label for="new-password">Nueva Contraseña</label>
                            <input type="password" id="new-password" placeholder="••••••••" minlength="6">
                        </div>
                        <div class="form-group">
                            <label for="confirm-password">Confirmar Nueva Contraseña</label>
                            <input type="password" id="confirm-password" placeholder="••••••••" minlength="6">
                        </div>
                    </div>
                    
                    <div class="actions">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Actualizar Perfil
                        </button>
                        <button type="button" id="change-password-btn" class="btn btn-warning">
                            <i class="fas fa-key"></i> Cambiar Contraseña
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <footer>
            <p>ParkMaster &copy; 2024 - Sistema de Gestión de Estacionamiento Profesional</p>
        </footer>
    </div>
    
    <div id="client-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-user-plus"></i> <span id="client-modal-title">Agregar Cliente</span></h3>
                <button class="close-modal" type="button">&times;</button>
            </div>
            
            <form id="client-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="client-name">Nombre Completo *</label>
                        <input type="text" id="client-name" required placeholder="Nombre del cliente">
                    </div>
                    <div class="form-group">
                        <label for="client-email">Email *</label>
                        <input type="email" id="client-email" required placeholder="cliente@email.com">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="client-password">Contraseña *</label>
                        <input type="text" id="client-password" required minlength="6" placeholder="Mínimo 6 caracteres">
                        <small>Esta será la contraseña para que el cliente inicie sesión</small>
                    </div>
                    <div class="form-group">
                        <label for="client-phone">Teléfono</label>
                        <input type="tel" id="client-phone" placeholder="+1234567890">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="client-address">Dirección</label>
                    <input type="text" id="client-address" placeholder="Dirección del cliente">
                </div>
                
                <h3><i class="fas fa-car"></i> Información del Vehículo</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="vehicle-plate">Placa *</label>
                        <input type="text" id="vehicle-plate" required placeholder="ABC123">
                    </div>
                    <div class="form-group">
                        <label for="vehicle-model">Marca/Modelo *</label>
                        <input type="text" id="vehicle-model" required placeholder="Toyota Corolla, Rojo">
                    </div>
                </div>
                
                <h3><i class="fas fa-calendar-alt"></i> Suscripción</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="subscription-space">Espacio Asignado *</label>
                        <select id="subscription-space" required>
                            <option value="">Seleccionar espacio</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="subscription-start">Fecha de Inicio *</label>
                        <input type="date" id="subscription-start" required>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="subscription-duration">Duración (meses) *</label>
                        <select id="subscription-duration" required>
                            <option value="1">1 mes</option>
                            <option value="3" selected>3 meses</option>
                            <option value="6">6 meses</option>
                            <option value="12">12 meses</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="subscription-amount">Monto Mensual ($) *</label>
                        <input type="number" id="subscription-amount" required min="0" step="0.01" placeholder="150.00">
                    </div>
                </div>
                
                <div class="actions">
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save"></i> Guardar Cliente
                    </button>
                    <button type="button" class="btn btn-danger close-modal">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="space-modal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-parking"></i> <span id="space-modal-title">Agregar Espacio</span></h3>
                <button class="close-modal" type="button">&times;</button>
            </div>
            
            <form id="space-form">
                <div class="form-group">
                    <label for="space-number">Número de Espacio *</label>
                    <input type="text" id="space-number" required placeholder="Ej: A-101">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="space-type">Tipo de Espacio *</label>
                        <select id="space-type" required>
                            <option value="regular">Regular</option>
                            <option value="premium">Premium</option>
                            <option value="handicap">Discapacitados</option>
                            <option value="motorcycle">Motocicleta</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="space-status">Estado *</label>
                        <select id="space-status" required>
                            <option value="available">Disponible</option>
                            <option value="occupied">Ocupado</option>
                            <option value="maintenance">En Mantenimiento</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="space-rate">Tarifa Mensual ($) *</label>
                    <input type="number" id="space-rate" required min="0" step="0.01" placeholder="150.00">
                </div>
                
                <div class="actions">
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save"></i> Guardar Espacio
                    </button>
                    <button type="button" class="btn btn-danger close-modal">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="sale-modal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h3 class="modal-title"><i class="fas fa-cash-register"></i> Registrar Venta</h3>
                <button class="close-modal" type="button">&times;</button>
            </div>
            
            <form id="sale-form">
                <div class="form-group">
                    <label for="sale-date">Fecha *</label>
                    <input type="date" id="sale-date" required>
                </div>
                
                <div class="form-group">
                    <label for="sale-concept">Concepto *</label>
                    <input type="text" id="sale-concept" required placeholder="Descripción de la venta">
                </div>
                
                <div class="form-group">
                    <label for="sale-vehicle">Vehículo/Placa</label>
                    <input type="text" id="sale-vehicle" placeholder="Vehículo o placa relacionada">
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="sale-type">Tipo de Venta *</label>
                        <select id="sale-type" required>
                            <option value="daily">Venta Diaria</option>
                            <option value="subscription">Suscripción</option>
                            <option value="other">Otro</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="sale-amount">Monto ($) *</label>
                        <input type="number" id="sale-amount" required min="0.01" step="0.01" placeholder="10.00">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="sale-payment">Método de Pago *</label>
                    <select id="sale-payment" required>
                        <option value="cash">Efectivo</option>
                        <option value="card">Tarjeta</option>
                        <option value="transfer">Transferencia</option>
                    </select>
                </div>
                
                <div class="actions">
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-save"></i> Registrar Venta
                    </button>
                    <button type="button" class="btn btn-danger close-modal">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // ==================== DATA STORE (In-Memory) ====================
        class DataStore {
            constructor() {
                this.users = [
                    { 
                        id: 1, 
                        name: "Administrador Principal", 
                        email: "admin@parkmaster.com", 
                        password: "admin123", 
                        role: "admin",
                        phone: "+1 234-567-8900",
                        address: "Av. Principal 123, Ciudad"
                    }
                ];
                
                this.clients = [
                    {
                        id: 1,
                        userId: 2,
                        name: "Juan Pérez",
                        email: "juan.perez@email.com",
                        password: "cliente123",
                        phone: "+57 300 123 4567",
                        address: "Calle 123 #45-67, Bogotá",
                        vehicle: {
                            model: "Toyota Corolla 2020, Rojo",
                            plate: "ABC123"
                        },
                        subscription: {
                            id: 1,
                            space: "A-101",
                            startDate: "2024-10-01",
                            endDate: "2025-01-01",
                            status: "active",
                            monthlyAmount: 150.00
                        },
                        paymentHistory: [
                            { date: "2024-10-01", amount: 150.00, method: "Efectivo", concept: "Pago inicial" },
                            { date: "2024-11-01", amount: 150.00, method: "Tarjeta", concept: "Pago mensual" }
                        ]
                    }
                ];
                
                this.parkingSpaces = [
                    { id: "A-101", status: "occupied", type: "regular", rate: 150.00, clientId: 1 },
                    { id: "A-102", status: "available", type: "regular", rate: 150.00 },
                    { id: "A-103", status: "available", type: "regular", rate: 150.00 },
                    { id: "A-104", status: "available", type: "premium", rate: 200.00 },
                    { id: "B-101", status: "available", type: "premium", rate: 200.00 },
                    { id: "B-102", status: "maintenance", type: "regular", rate: 150.00 },
                    { id: "B-103", status: "available", type: "handicap", rate: 150.00 },
                    { id: "C-101", status: "available", type: "motorcycle", rate: 80.00 }
                ];
                
                this.dailySales = [
                    { 
                        id: 1, 
                        date: "2024-10-16", 
                        concept: "Suscripción mensual - Juan Pérez", 
                        vehicle: "ABC123", 
                        type: "subscription", 
                        amount: 150.00, 
                        payment: "cash" 
                    },
                    { 
                        id: 2, 
                        date: "2024-10-16", 
                        concept: "Estacionamiento temporal", 
                        vehicle: "XYZ789", 
                        type: "daily", 
                        amount: 15.00, 
                        payment: "card" 
                    }
                ];
            }
            
            getNextId(array) {
                return array.length > 0 ? Math.max(...array.map(item => item.id)) + 1 : 1;
            }
        }
        
        // ==================== APPLICATION STATE ====================
        const store = new DataStore();
        let currentUser = null;
        let editingClientId = null;
        let editingSpaceId = null;
        
        // ==================== UTILITY FUNCTIONS ====================
        const Utils = {
            formatDate(dateString) {
                const options = { year: 'numeric', month: 'long', day: 'numeric' };
                return new Date(dateString).toLocaleDateString('es-ES', options);
            },
            
            formatCurrency(amount) {
                return new Intl.NumberFormat('es-CO', {
                    style: 'currency',
                    currency: 'COP',
                    minimumFractionDigits: 2
                }).format(amount);
            },
            
            generateRandomPassword(length = 8) {
                const chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
                return Array.from({length}, () => chars[Math.floor(Math.random() * chars.length)]).join('');
            },
            
            calculateDaysUntilDue(endDate) {
                const today = new Date();
                const due = new Date(endDate);
                const diffTime = due - today;
                return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            },
            
            calculateSubscriptionStatus(endDate) {
                const daysLeft = this.calculateDaysUntilDue(endDate);
                if (daysLeft < 0) return 'expired';
                if (daysLeft <= 7) return 'warning';
                return 'active';
            },
            
            getStatusText(status) {
                const texts = {
                    'active': 'Activa',
                    'warning': 'Por Vencer',
                    'expired': 'Vencida',
                    'available': 'Disponible',
                    'occupied': 'Ocupado',
                    'maintenance': 'Mantenimiento'
                };
                return texts[status] || 'Desconocido';
            },
            
            showNotification(message, type = 'success') {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.className = `notification ${type} show`;
                
                setTimeout(() => {
                    notification.classList.remove('show');
                }, 5000);
            },
            
            validateEmail(email) {
                return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
            },
            
            sanitizeInput(input) {
                return input.trim().replace(/[<>]/g, '');
            }
        };
        
        // ==================== AUTHENTICATION ====================
        const Auth = {
            login(email, password) {
                // Buscar en usuarios admin
                const adminUser = store.users.find(u => u.email === email && u.password === password);
                if (adminUser) {
                    return { success: true, user: adminUser };
                }
                
                // Buscar en clientes
                const clientData = store.clients.find(c => c.email === email && c.password === password);
                if (clientData) {
                    return { 
                        success: true, 
                        user: {
                            id: clientData.userId,
                            name: clientData.name,
                            email: clientData.email,
                            password: clientData.password,
                            role: "client",
                            phone: clientData.phone,
                            address: clientData.address
                        }
                    };
                }
                
                return { success: false, message: 'Email o contraseña incorrectos' };
            },
            
            logout() {
                currentUser = null;
                UI.showLoginScreen();
                Utils.showNotification('Sesión cerrada correctamente', 'success');
            }
        };
        
        // ==================== UI MANAGER ====================
        const UI = {
            showLoginScreen() {
                document.getElementById('login-screen').style.display = 'block';
                document.getElementById('app').style.display = 'none';
                document.getElementById('login-form').reset();
            },
            
            showApp() {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('app').style.display = 'block';
                
                // Actualizar información del usuario
                document.getElementById('user-name').textContent = currentUser.name;
                document.getElementById('user-role').textContent = 
                    currentUser.role === 'admin' ? 'Administrador' : 'Cliente';
                document.getElementById('user-role').className = `user-role ${currentUser.role}`;
                
                // Configurar interfaz según el rol
                this.setupUIForRole(currentUser.role);
                
                // Cargar dashboard
                Dashboard.load();
                
                Utils.showNotification(`Bienvenido/a, ${currentUser.name}`, 'success');
            },
            
            setupUIForRole(role) {
                const adminElements = document.querySelectorAll('.admin-only');
                
                if (role === 'admin') {
                    adminElements.forEach(el => el.style.display = 'block');
                    document.getElementById('admin-dashboard').style.display = 'block';
                    document.getElementById('client-dashboard').style.display = 'none';
                } else {
                    adminElements.forEach(el => el.style.display = 'none');
                    document.getElementById('admin-dashboard').style.display = 'none';
                    document.getElementById('client-dashboard').style.display = 'block';
                }
            },
            
            switchModule(moduleName) {
                // Ocultar todos los módulos
                document.querySelectorAll('.module').forEach(module => {
                    module.classList.remove('active');
                });
                
                // Remover clase active de todos los enlaces
                document.querySelectorAll('.nav-link').forEach(link => {
                    link.classList.remove('active');
                });
                
                // Mostrar módulo seleccionado
                const targetModule = document.getElementById(moduleName);
                if (targetModule) {
                    targetModule.classList.add('active');
                }
                
                // Activar enlace correspondiente
                const activeLink = document.querySelector(`.nav-link[data-module="${moduleName}"]`);
                if (activeLink) {
                    activeLink.classList.add('active');
                }
                
                // Cargar datos del módulo
                switch(moduleName) {
                    case 'clients':
                        if (currentUser.role === 'admin') ClientsModule.load();
                        break;
                    case 'spaces':
                        if (currentUser.role === 'admin') SpacesModule.load();
                        break;
                    case 'sales':
                        if (currentUser.role === 'admin') SalesModule.load();
                        break;
                    case 'accounting':
                        if (currentUser.role === 'admin') AccountingModule.load();
                        break;
                    case 'profile':
                        ProfileModule.load();
                        break;
                }
            },
            
            showModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.style.display = 'flex';
                }
            },
            
            hideModal(modalId) {
                const modal = document.getElementById(modalId);
                if (modal) {
                    modal.style.display = 'none';
                }
            }
        };
        
        // ==================== DASHBOARD MODULE ====================
        const Dashboard = {
            load() {
                if (currentUser.role === 'admin') {
                    this.loadAdminDashboard();
                } else {
                    this.loadClientDashboard();
                }
            },
            
            loadAdminDashboard() {
                this.updateStats();
                this.renderRecentClients();
            },
            
            updateStats() {
                // Actualizar suscripciones
                store.clients.forEach(client => {
                    client.subscription.status = Utils.calculateSubscriptionStatus(client.subscription.endDate);
                });
                
                document.getElementById('total-clients').textContent = store.clients.length;
                document.getElementById('active-subscriptions').textContent = 
                    store.clients.filter(c => c.subscription.status === 'active').length;
                document.getElementById('warning-subscriptions').textContent = 
                    store.clients.filter(c => c.subscription.status === 'warning').length;
                document.getElementById('expired-subscriptions').textContent = 
                    store.clients.filter(c => c.subscription.status === 'expired').length;
                
                // Calcular ingresos mensuales
                const now = new Date();
                const monthlyIncome = store.clients
                    .filter(c => c.subscription.status === 'active')
                    .reduce((sum, c) => sum + c.subscription.monthlyAmount, 0);
                
                document.getElementById('monthly-income').textContent = `${monthlyIncome.toFixed(2)}`;
                
                // Ventas de hoy
                const today = now.toISOString().split('T')[0];
                const todaySales = store.dailySales
                    .filter(s => s.date === today)
                    .reduce((sum, s) => sum + s.amount, 0);
                
                document.getElementById('today-sales').textContent = `${todaySales.toFixed(2)}`;
            },
            
            renderRecentClients() {
                const container = document.getElementById('clients-list-dashboard');
                container.innerHTML = '';
                
                if (store.clients.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-users"></i>
                            <h3>No hay clientes registrados</h3>
                            <p>Agrega tu primer cliente para comenzar</p>
                        </div>
                    `;
                    return;
                }
                
                // Mostrar los primeros 5 clientes
                const recentClients = store.clients.slice(0, 5);
                
                recentClients.forEach(client => {
                    const daysLeft = Utils.calculateDaysUntilDue(client.subscription.endDate);
                    const card = this.createClientCard(client, daysLeft);
                    container.appendChild(card);
                });
            },
            
            createClientCard(client, daysLeft) {
                const card = document.createElement('div');
                card.className = `client-card ${client.subscription.status}`;
                
                card.innerHTML = `
                    <div class="card-header">
                        <div class="client-name">${client.name}</div>
                        <div class="status ${client.subscription.status}">
                            ${Utils.getStatusText(client.subscription.status)}
                        </div>
                    </div>
                    <div class="card-details">
                        <div class="detail-item">
                            <span class="detail-label">Email:</span> ${client.email}
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Vehículo:</span> ${client.vehicle.model}
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Placa:</span> ${client.vehicle.plate}
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Espacio:</span> ${client.subscription.space}
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Vence:</span> ${Utils.formatDate(client.subscription.endDate)}
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Días:</span> ${daysLeft > 0 ? daysLeft : 0}
                        </div>
                    </div>
                    <div class="actions">
                        <button class="btn btn-primary" onclick="ClientsModule.edit(${client.id})">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                    </div>
                `;
                
                return card;
            },
            
            loadClientDashboard() {
                const client = store.clients.find(c => c.email === currentUser.email);
                
                if (!client) return;
                
                // Actualizar estado
                client.subscription.status = Utils.calculateSubscriptionStatus(client.subscription.endDate);
                
                // Actualizar información
                document.getElementById('client-dash-name').textContent = client.name;
                document.getElementById('client-dash-vehicle').textContent = client.vehicle.model;
                document.getElementById('client-dash-plate').textContent = client.vehicle.plate;
                document.getElementById('client-dash-space').textContent = client.subscription.space;
                document.getElementById('client-dash-expiry').textContent = Utils.formatDate(client.subscription.endDate);
                document.getElementById('client-dash-amount').textContent = `${client.subscription.monthlyAmount.toFixed(2)}`;
                
                const daysLeft = Utils.calculateDaysUntilDue(client.subscription.endDate);
                document.getElementById('client-dash-days').textContent = daysLeft > 0 ? daysLeft : 0;
                
                const statusEl = document.getElementById('client-dash-status');
                statusEl.textContent = Utils.getStatusText(client.subscription.status);
                statusEl.className = `status ${client.subscription.status}`;
                
                // Renderizar historial de pagos
                this.renderPaymentHistory(client.paymentHistory);
            },
            
            renderPaymentHistory(payments) {
                const container = document.getElementById('payment-history');
                container.innerHTML = '';
                
                if (!payments || payments.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-history"></i>
                            <h3>No hay historial de pagos</h3>
                        </div>
                    `;
                    return;
                }
                
                payments.forEach(payment => {
                    const card = document.createElement('div');
                    card.className = 'client-card';
                    card.innerHTML = `
                        <div class="card-details">
                            <div class="detail-item">
                                <span class="detail-label">Fecha:</span> ${Utils.formatDate(payment.date)}
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Monto:</span> ${payment.amount.toFixed(2)}
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Método:</span> ${payment.method}
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Concepto:</span> ${payment.concept}
                            </div>
                        </div>
                    `;
                    container.appendChild(card);
                });
            }
        };
        
        // ==================== CLIENTS MODULE ====================
        const ClientsModule = {
            load() {
                this.render();
            },
            
            render() {
                const container = document.getElementById('clients-list');
                container.innerHTML = '';
                
                if (store.clients.length === 0) {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-users"></i>
                            <h3>No hay clientes registrados</h3>
                            <p>Agrega tu primer cliente para comenzar</p>
                        </div>
                    `;
                    return;
                }
                
                store.clients.forEach(client => {
                    client.subscription.status = Utils.calculateSubscriptionStatus(client.subscription.endDate);
                    const daysLeft = Utils.calculateDaysUntilDue(client.subscription.endDate);
                    
                    const card = document.createElement('div');
                    card.className = `client-card ${client.subscription.status}`;
                    
                    card.innerHTML = `
                        <div class="card-header">
                            <div class="client-name">${client.name}</div>
                            <div class="status ${client.subscription.status}">
                                ${Utils.getStatusText(client.subscription.status)}
                            </div>
                        </div>
                        <div class="card-details">
                            <div class="detail-item">
                                <span class="detail-label">Email:</span> ${client.email}
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Teléfono:</span> ${client.phone || 'No especificado'}
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Vehículo:</span> ${client.vehicle.model}
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Placa:</span> ${client.vehicle.plate}
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Espacio:</span> ${client.subscription.space}
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Vence:</span> ${Utils.formatDate(client.subscription.endDate)}
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Días restantes:</span> ${daysLeft > 0 ? daysLeft : 0}
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Monto Mensual:</span> ${client.subscription.monthlyAmount.toFixed(2)}
                            </div>
                        </div>
                        <div class="actions">
                            <button class="btn btn-primary" onclick="ClientsModule.edit(${client.id})">
                                <i class="fas fa-edit"></i> Editar
                            </button>
                            <button class="btn btn-danger" onclick="ClientsModule.delete(${client.id})">
                                <i class="fas fa-trash"></i> Eliminar
                            </button>
                        </div>
                    `;
                    
                    container.appendChild(card);
                });
            },
            
            showAddModal() {
                editingClientId = null;
                document.getElementById('client-modal-title').textContent = 'Agregar Cliente';
                document.getElementById('client-form').reset();
                document.getElementById('client-password').value = Utils.generateRandomPassword();
                document.getElementById('subscription-start').value = new Date().toISOString().split('T')[0];
                document.getElementById('subscription-amount').value = 150.00;
                this.loadAvailableSpaces();
                UI.showModal('client-modal');
            },
            
            edit(id) {
                const client = store.clients.find(c => c.id === id);
                if (!client) return;
                
                editingClientId = id;
                document.getElementById('client-modal-title').textContent = 'Editar Cliente';
                document.getElementById('client-name').value = client.name;
                document.getElementById('client-email').value = client.email;
                document.getElementById('client-password').value = client.password;
                document.getElementById('client-phone').value = client.phone || '';
                document.getElementById('client-address').value = client.address || '';
                document.getElementById('vehicle-plate').value = client.vehicle.plate;
                document.getElementById('vehicle-model').value = client.vehicle.model;
                document.getElementById('subscription-start').value = client.subscription.startDate;
                
                // Calcular duración
                const start = new Date(client.subscription.startDate);
                const end = new Date(client.subscription.endDate);
                const duration = Math.round((end - start) / (1000 * 60 * 60 * 24 * 30));
                document.getElementById('subscription-duration').value = duration;
                
                document.getElementById('subscription-amount').value = client.subscription.monthlyAmount;
                
                // Cargar espacios
                this.loadAvailableSpaces(client.subscription.space);
                
                UI.showModal('client-modal');
            },
            
            loadAvailableSpaces(currentSpace = null) {
                const select = document.getElementById('subscription-space');
                select.innerHTML = '<option value="">Seleccionar espacio</option>';
                
                store.parkingSpaces.forEach(space => {
                    if (space.status === 'available' || space.id === currentSpace) {
                        const option = document.createElement('option');
                        option.value = space.id;
                        option.textContent = `${space.id} (${space.type}) - ${space.rate}`;
                        if (space.id === currentSpace) {
                            option.selected = true;
                        }
                        select.appendChild(option);
                    }
                });
            },
            
            save(formData) {
                // Validaciones
                if (!Utils.validateEmail(formData.email)) {
                    Utils.showNotification('Email inválido', 'error');
                    return false;
                }
                
                if (formData.password.length < 6) {
                    Utils.showNotification('La contraseña debe tener al menos 6 caracteres', 'error');
                    return false;
                }
                
                // Verificar email único (solo en agregar)
                if (!editingClientId) {
                    const emailExists = store.clients.some(c => c.email === formData.email) ||
                                      store.users.some(u => u.email === formData.email);
                    if (emailExists) {
                        Utils.showNotification('El email ya está registrado', 'error');
                        return false;
                    }
                }
                
                // Calcular fecha de fin
                const startDate = new Date(formData.startDate);
                const endDate = new Date(startDate);
                endDate.setMonth(endDate.getMonth() + parseInt(formData.duration));
                const endDateStr = endDate.toISOString().split('T')[0];
                
                if (editingClientId) {
                    // Editar cliente
                    const index = store.clients.findIndex(c => c.id === editingClientId);
                    const oldSpace = store.clients[index].subscription.space;
                    
                    store.clients[index] = {
                        ...store.clients[index],
                        name: formData.name,
                        email: formData.email,
                        password: formData.password,
                        phone: formData.phone,
                        address: formData.address,
                        vehicle: {
                            plate: formData.plate,
                            model: formData.model
                        },
                        subscription: {
                            ...store.clients[index].subscription,
                            space: formData.space,
                            startDate: formData.startDate,
                            endDate: endDateStr,
                            status: Utils.calculateSubscriptionStatus(endDateStr),
                            monthlyAmount: formData.amount
                        }
                    };
                    
                    this.updateSpaceAssignment(oldSpace, formData.space, editingClientId);
                    Utils.showNotification('Cliente actualizado exitosamente', 'success');
                } else {
                    // Agregar cliente
                    const newClient = {
                        id: store.getNextId(store.clients),
                        userId: store.getNextId([...store.users, ...store.clients]),
                        name: formData.name,
                        email: formData.email,
                        password: formData.password,
                        phone: formData.phone,
                        address: formData.address,
                        vehicle: {
                            plate: formData.plate,
                            model: formData.model
                        },
                        subscription: {
                            id: store.getNextId(store.clients.map(c => ({id: c.subscription.id}))),
                            space: formData.space,
                            startDate: formData.startDate,
                            endDate: endDateStr,
                            status: Utils.calculateSubscriptionStatus(endDateStr),
                            monthlyAmount: formData.amount
                        },
                        paymentHistory: [
                            { 
                                date: formData.startDate, 
                                amount: formData.amount, 
                                method: "Pago inicial",
                                concept: "Suscripción inicial"
                            }
                        ]
                    };
                    
                    store.clients.push(newClient);
                    this.updateSpaceAssignment(null, formData.space, newClient.id);
                    
                    Utils.showNotification(
                        `Cliente agregado. Credenciales: ${formData.email} / ${formData.password}`, 
                        'success'
                    );
                }
                
                // Actualizar UI
                Dashboard.updateStats();
                Dashboard.renderRecentClients();
                this.render();
                SpacesModule.load();
                
                return true;
            },
            
            updateSpaceAssignment(oldSpace, newSpace, clientId) {
                // Liberar espacio anterior
                if (oldSpace) {
                    const oldSpaceObj = store.parkingSpaces.find(s => s.id === oldSpace);
                    if (oldSpaceObj) {
                        oldSpaceObj.status = 'available';
                        delete oldSpaceObj.clientId;
                    }
                }
                
                // Ocupar nuevo espacio
                const newSpaceObj = store.parkingSpaces.find(s => s.id === newSpace);
                if (newSpaceObj) {
                    newSpaceObj.status = 'occupied';
                    newSpaceObj.clientId = clientId;
                }
            },
            
            delete(id) {
                const client = store.clients.find(c => c.id === id);
                if (!client) return;
                
                if (!confirm(`¿Eliminar al cliente ${client.name}? Esta acción no se puede deshacer.`)) {
                    return;
                }
                
                // Liberar espacio
                const space = store.parkingSpaces.find(s => s.id === client.subscription.space);
                if (space) {
                    space.status = 'available';
                    delete space.clientId;
                }
                
                // Eliminar cliente
                store.clients = store.clients.filter(c => c.id !== id);
                
                Utils.showNotification(`Cliente ${client.name} eliminado`, 'success');
                
                // Actualizar UI
                Dashboard.updateStats();
                Dashboard.renderRecentClients();
                this.render();
                SpacesModule.load();
            },
            
            exportToExcel() {
                const data = store.clients.map(client => ({
                    'Nombre': client.name,
                    'Email': client.email,
                    'Teléfono': client.phone || '',
                    'Dirección': client.address || '',
                    'Vehículo': client.vehicle.model,
                    'Placa': client.vehicle.plate,
                    'Espacio': client.subscription.space,
                    'Fecha Inicio': client.subscription.startDate,
                    'Fecha Fin': client.subscription.endDate,
                    'Estado': Utils.getStatusText(client.subscription.status),
                    'Monto Mensual': client.subscription.monthlyAmount,
                    'Días Restantes': Utils.calculateDaysUntilDue(client.subscription.endDate)
                }));
                
                const ws = XLSX.utils.json_to_sheet(data);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, "Clientes");
                
                const today = new Date().toISOString().split('T')[0];
                XLSX.writeFile(wb, `clientes_parkmaster_${today}.xlsx`);
                
                Utils.showNotification('Datos exportados a Excel', 'success');
            }
        };
        
        // ==================== SPACES MODULE ====================
        const SpacesModule = {
            load() {
                this.updateStats();
                this.render();
            },
            
            updateStats() {
                document.getElementById('total-spaces').textContent = store.parkingSpaces.length;
                document.getElementById('available-spaces').textContent = 
                    store.parkingSpaces.filter(s => s.status === 'available').length;
                document.getElementById('occupied-spaces').textContent = 
                    store.parkingSpaces.filter(s => s.status === 'occupied').length;
                document.getElementById('maintenance-spaces').textContent = 
                    store.parkingSpaces.filter(s => s.status === 'maintenance').length;
            },
            
            render() {
                const container = document.getElementById('spaces-grid');
                container.innerHTML = '';
                
                store.parkingSpaces.forEach(space => {
                    const spaceEl = document.createElement('div');
                    spaceEl.className = `space-item ${space.status}`;
                    
                    let clientInfo = '';
                    if (space.status === 'occupied') {
                        const client = store.clients.find(c => c.id === space.clientId);
                        clientInfo = client ? `<div class="space-info">${client.name}</div>` : '';
                    }
                    
                    const typeText = {
                        'regular': 'Regular',
                        'premium': 'Premium',
                        'handicap': 'Discapacitados',
                        'motorcycle': 'Motocicleta'
                    };
                    
                    spaceEl.innerHTML = `
                        <div class="space-number">${space.id}</div>
                        <div class="status ${space.status}">
                            ${Utils.getStatusText(space.status)}
                        </div>
                        <div class="space-info">${typeText[space.type]}</div>
                        <div class="space-info">${space.rate}/mes</div>
                        ${clientInfo}
                        <div class="space-actions">
                            <button class="btn btn-primary" onclick="SpacesModule.edit('${space.id}')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-danger" onclick="SpacesModule.delete('${space.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                    
                    container.appendChild(spaceEl);
                });
            },
            
            showAddModal() {
                editingSpaceId = null;
                document.getElementById('space-modal-title').textContent = 'Agregar Espacio';
                document.getElementById('space-form').reset();
                document.getElementById('space-rate').value = 150.00;
                UI.showModal('space-modal');
            },
            
            edit(id) {
                const space = store.parkingSpaces.find(s => s.id === id);
                if (!space) return;
                
                editingSpaceId = id;
                document.getElementById('space-modal-title').textContent = 'Editar Espacio';
                document.getElementById('space-number').value = space.id;
                document.getElementById('space-type').value = space.type;
                document.getElementById('space-status').value = space.status;
                document.getElementById('space-rate').value = space.rate;
                
                UI.showModal('space-modal');
            },
            
            save(formData) {
                if (editingSpaceId) {
                    // Editar espacio
                    const index = store.parkingSpaces.findIndex(s => s.id === editingSpaceId);
                    if (index !== -1) {
                        store.parkingSpaces[index] = {
                            ...store.parkingSpaces[index],
                            id: formData.number,
                            type: formData.type,
                            status: formData.status,
                            rate: formData.rate
                        };
                    }
                    Utils.showNotification('Espacio actualizado', 'success');
                } else {
                    // Verificar si existe
                    if (store.parkingSpaces.some(s => s.id === formData.number)) {
                        Utils.showNotification('El espacio ya existe', 'error');
                        return false;
                    }
                    
                    // Agregar espacio
                    store.parkingSpaces.push({
                        id: formData.number,
                        type: formData.type,
                        status: formData.status,
                        rate: formData.rate
                    });
                    Utils.showNotification('Espacio agregado', 'success');
                }
                
                this.load();
                return true;
            },
            
            delete(id) {
                const space = store.parkingSpaces.find(s => s.id === id);
                if (!space) return;
                
                // Verificar si está asignado
                const client = store.clients.find(c => c.subscription.space === id);
                if (client) {
                    Utils.showNotification('No se puede eliminar. Espacio asignado a un cliente', 'error');
                    return;
                }
                
                if (!confirm(`¿Eliminar el espacio ${id}?`)) return;
                
                store.parkingSpaces = store.parkingSpaces.filter(s => s.id !== id);
                Utils.showNotification('Espacio eliminado', 'success');
                this.load();
            }
        };
        
        // ==================== SALES MODULE ====================
        const SalesModule = {
            load() {
                this.updateStats();
                this.render();
            },
            
            updateStats() {
                const today = new Date().toISOString().split('T')[0];
                const todaySales = store.dailySales
                    .filter(s => s.date === today)
                    .reduce((sum, s) => sum + s.amount, 0);
                
                document.getElementById('today-sales-amount').textContent = `${todaySales.toFixed(2)}`;
                
                const now = new Date();
                const monthSales = store.dailySales
                    .filter(s => {
                        const d = new Date(s.date);
                        return d.getMonth() === now.getMonth() && d.getFullYear() === now.getFullYear();
                    })
                    .reduce((sum, s) => sum + s.amount, 0);
                
                document.getElementById('month-sales-amount').textContent = `${monthSales.toFixed(2)}`;
                
                const totalSales = store.dailySales.reduce((sum, s) => sum + s.amount, 0);
                document.getElementById('total-sales-amount').textContent = `${totalSales.toFixed(2)}`;
                
                const avgSales = store.dailySales.length > 0 ? totalSales / store.dailySales.length : 0;
                document.getElementById('average-daily-sales').textContent = `${avgSales.toFixed(2)}`;
            },
            
            render() {
                const tbody = document.getElementById('sales-table-body');
                tbody.innerHTML = '';
                
                if (store.dailySales.length === 0) {
                    tbody.innerHTML = `
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 30px;">
                                <i class="fas fa-cash-register" style="font-size: 2rem; color: #ddd;"></i>
                                <p>No hay ventas registradas</p>
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                const sorted = [...store.dailySales].sort((a, b) => new Date(b.date) - new Date(a.date));
                
                sorted.forEach(sale => {
                    const row = document.createElement('tr');
                    
                    const typeText = {
                        'daily': 'Venta Diaria',
                        'subscription': 'Suscripción',
                        'other': 'Otro'
                    };
                    
                    const paymentText = {
                        'cash': 'Efectivo',
                        'card': 'Tarjeta',
                        'transfer': 'Transferencia'
                    };
                    
                    row.innerHTML = `
                        <td>${Utils.formatDate(sale.date)}</td>
                        <td>${sale.concept}</td>
                        <td>${sale.vehicle || '-'}</td>
                        <td>${typeText[sale.type]}</td>
                        <td>${sale.amount.toFixed(2)}</td>
                        <t
                                <span class="detail-label">Vehículo:</span>
                                <span id="client-dash-vehicle">-</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Placa:</span>
                                <span id="client-dash-plate">-</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Espacio Asignado:</span>
                                <span id="client-dash-space">-</span>
                            </div>
                            <div class="detail-item">
                